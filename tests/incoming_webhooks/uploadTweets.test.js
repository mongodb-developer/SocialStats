const uploadTweets = require('../../services/uploadTweets/incoming_webhooks/webhook0/source.js');

const mockTweetResults = {
    newTweets: ["1226928883355791361"],
    tweetsNotInsertedOrUpdated: ["1226928883355791362"],
    updatedTweets: ["1226928883355791360"]
}

beforeEach(() => {

    // Mock the storeCsvInDb function 
    global.context = {
        functions: {
            execute: jest.fn((functionName, data) => {
                return mockTweetResults;
            })
        }
    }
});

test('Single csv file with lots of tweets', () => {
    // Note that the results we're expecting don't actually match the tweets that are in 
    // the body below, but it's fine as we're not testing that part of the functionality here

    expect(uploadTweets({
        body: {
            text: () => {
                return `-----------------------------8165087126414182542096170685\r\nContent-Disposition: form-data; name=\"Tweetcsv\"; filename=\"tweet_activity_metrics_Lauren_Schaefer_20200114_20200211_en (1).csv\"\r\nContent-Type: text/csv\r\n\r\n\"Tweet id\",\"Tweet permalink\",\"Tweet text\",\"time\",\"impressions\",\"engagements\",\"engagement rate\",\"retweets\",\"replies\",\"likes\",\"user profile clicks\",\"url clicks\",\"hashtag clicks\",\"detail expands\",\"permalink clicks\",\"app opens\",\"app installs\",\"follows\",\"email tweet\",\"dial phone\",\"media views\",\"media engagements\",\"promoted impressions\",\"promoted engagements\",\"promoted engagement rate\",\"promoted retweets\",\"promoted replies\",\"promoted likes\",\"promoted user profile clicks\",\"promoted url clicks\",\"promoted hashtag clicks\",\"promoted detail expands\",\"promoted permalink clicks\",\"promoted app opens\",\"promoted app installs\",\"promoted follows\",\"promoted email tweet\",\"promoted dial phone\",\"promoted media views\",\"promoted media engagements\"\n\"1226928883355791360\",\"https://twitter.com/Lauren_Schaefer/status/1226928883355791360\",\"“Whether your company is based in a lower-paying area, or your employee is based in a lower-paying area does not matter...if you want to attract and retain above-average developers... #RemoteWork is a big bonus attraction to half of the tech workforce.”\n\nhttps://t.co/wso3RTFd1u\",\"2020-02-10 18:00 +0000\",\"1203.0\",\"39.0\",\"ssss\",\"4.0\",\"0.0\",\"7.0\",\"2.0\",\"22.0\",\"0.0\",\"4.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1226846945181917184\",\"https://twitter.com/Lauren_Schaefer/status/1226846945181917184\",\"@h_ingo Yes! It's so helpful. I'm working on using it more and more.\",\"2020-02-10 12:34 +0000\",\"32.0\",\"1.0\",\"0.03125\",\"0.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1226846634702757889\",\"https://twitter.com/Lauren_Schaefer/status/1226846634702757889\",\"@h_ingo https://t.co/n2tX8TNJFL\",\"2020-02-10 12:33 +0000\",\"35.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1226846610593845250\",\"https://twitter.com/Lauren_Schaefer/status/1226846610593845250\",\"@h_ingo Definitely. On a related node - I read an article that suggested remote teams focus more on results than other factors like politics or likability, which can reduce unconscious bias. This is a win for everyone--especially those from traditionally underrepresented groups.\",\"2020-02-10 12:33 +0000\",\"134.0\",\"2.0\",\"0.014925373134328358\",\"0.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225790691214811136\",\"https://twitter.com/Lauren_Schaefer/status/1225790691214811136\",\"@itsaydrian Perhaps.  Although, I find it's true in larger groups as well.\",\"2020-02-07 14:37 +0000\",\"88.0\",\"6.0\",\"0.06818181818181818\",\"0.0\",\"1.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"4.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225785799146430465\",\"https://twitter.com/Lauren_Schaefer/status/1225785799146430465\",\"I've found that I notice less that I'm the only woman in the \"\"room\"\" when I work remotely vs working in the office. My minority status feels less isolating when I'm remote. \n\nI can't find any stats or articles to back this up. Anyone else feel the same?\n\n#RemoteWork #WorkFromHome\",\"2020-02-07 14:18 +0000\",\"836.0\",\"18.0\",\"0.0215311004784689\",\"1.0\",\"2.0\",\"6.0\",\"3.0\",\"0.0\",\"1.0\",\"5.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225479302868873216\",\"https://twitter.com/Lauren_Schaefer/status/1225479302868873216\",\"For the fellow #parents out there...\n\nTech conferences with childcare\n\nhttps://t.co/91SuX4nHIy\n\n#WomenInTech #WomenInSTEM #PeopleInTech\",\"2020-02-06 18:00 +0000\",\"308.0\",\"4.0\",\"0.012987012987012988\",\"1.0\",\"0.0\",\"3.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225103341283348481\",\"https://twitter.com/Lauren_Schaefer/status/1225103341283348481\",\"@itsaydrian @mlynn @MongoDB https://t.co/MjghgZfXaP\",\"2020-02-05 17:06 +0000\",\"75.0\",\"2.0\",\"0.02666666666666667\",\"0.0\",\"0.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"12\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225099723335503875\",\"https://twitter.com/Lauren_Schaefer/status/1225099723335503875\",\"@mlynn @MongoDB https://t.co/cB2i0Ho4B5\",\"2020-02-05 16:51 +0000\",\"131.0\",\"4.0\",\"0.030534351145038167\",\"0.0\",\"1.0\",\"1.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"24\",\"1\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224720773413249025\",\"https://twitter.com/Lauren_Schaefer/status/1224720773413249025\",\"@TheLeadDev Thank you!\",\"2020-02-04 15:46 +0000\",\"39.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224713763821162497\",\"https://twitter.com/Lauren_Schaefer/status/1224713763821162497\",\"@TheLeadDev How many attendees are you anticipating?\",\"2020-02-04 15:18 +0000\",\"145.0\",\"3.0\",\"0.020689655172413793\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"2.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224671846056058884\",\"https://twitter.com/Lauren_Schaefer/status/1224671846056058884\",\"@jessicaewest @LaunchDarkly So happy for you Jess! https://t.co/gh7dsvdmNu\",\"2020-02-04 12:31 +0000\",\"78.0\",\"2.0\",\"0.02564102564102564\",\"0.0\",\"1.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"23\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224392302615048192\",\"https://twitter.com/Lauren_Schaefer/status/1224392302615048192\",\"What is #JavaScript made of by @dan_abramov? https://t.co/A69ugbmEdt\n\nA great reminder of the JavaScript basics\",\"2020-02-03 18:00 +0000\",\"216.0\",\"2.0\",\"0.009259259259259259\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224126591917264899\",\"https://twitter.com/Lauren_Schaefer/status/1224126591917264899\",\"Is there enough space in space for women?\n\n#MakeSpaceForWomen https://t.co/uPGApiLveh\",\"2020-02-03 00:24 +0000\",\"339.0\",\"3.0\",\"0.008849557522123894\",\"0.0\",\"0.0\",\"1.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222942690037379072\",\"https://twitter.com/Lauren_Schaefer/status/1222942690037379072\",\"How to evaluate a remote job https://t.co/FngPIiHTx0\n\n#remotework #WorkFromHome\",\"2020-01-30 18:00 +0000\",\"289.0\",\"2.0\",\"0.006920415224913495\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222583861579780096\",\"https://twitter.com/Lauren_Schaefer/status/1222583861579780096\",\"@nraboy @kenwalger Good call. https://t.co/SLbbsthzmF\",\"2020-01-29 18:14 +0000\",\"75.0\",\"1.0\",\"0.013333333333333334\",\"0.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"10\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222583364055642114\",\"https://twitter.com/Lauren_Schaefer/status/1222583364055642114\",\"@nraboy @kenwalger Is that expensable?\",\"2020-01-29 18:12 +0000\",\"76.0\",\"3.0\",\"0.039473684210526314\",\"0.0\",\"1.0\",\"0.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222581543702597634\",\"https://twitter.com/Lauren_Schaefer/status/1222581543702597634\",\"What does #RonSwanson have to do with #MongoDB?\n\nWatch the recording of the Back to Basics webinar that @kenwalger and I hosted to find out:  https://t.co/WOgtUAcKrW https://t.co/1oCJ4Pe9dd\",\"2020-01-29 18:05 +0000\",\"639.0\",\"18.0\",\"0.028169014084507043\",\"0.0\",\"1.0\",\"4.0\",\"3.0\",\"5.0\",\"0.0\",\"2.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"88\",\"3\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222222732953341954\",\"https://twitter.com/Lauren_Schaefer/status/1222222732953341954\",\"@ChegeHarrison @kenwalger https://t.co/TyaripZjmV\",\"2020-01-28 18:19 +0000\",\"77.0\",\"2.0\",\"0.025974025974025976\",\"0.0\",\"0.0\",\"1.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"15\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1221855530232225794\",\"https://twitter.com/Lauren_Schaefer/status/1221855530232225794\",\"Fantastic 13 minute keynote from @kelseyhightower where he touches on #diversity, #inclusion, &amp; running the race together. https://t.co/03X29YQr4j\",\"2020-01-27 18:00 +0000\",\"26818.0\",\"230.0\",\"0.008576329331046312\",\"4.0\",\"1.0\",\"12.0\",\"91.0\",\"58.0\",\"4.0\",\"16.0\",\"0.0\",\"1\",\"0\",\"0\",\"0\",\"0\",\"43\",\"43\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1220747798100021248\",\"https://twitter.com/Lauren_Schaefer/status/1220747798100021248\",\".@kenwalger and I are hosting a #MongoDB Back to Basics webinar Tuesday, January 28 at noon eastern. Hope to see you there!\n\nSlides: https://t.co/4t7jYcjKk6\nRegister: https://t.co/D8zKU3BKDc\",\"2020-01-24 16:38 +0000\",\"805.0\",\"126.0\",\"0.1565217391304348\",\"1.0\",\"0.0\",\"6.0\",\"10.0\",\"107.0\",\"0.0\",\"2.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1220405881155866626\",\"https://twitter.com/Lauren_Schaefer/status/1220405881155866626\",\"I was asked to sum up my remote work experience in one word. I chose \"\"quiet.\"\" This could explain why. When I'm working, I have guilt-free time to sit and think uninterrupted. And I really enjoy that.\n\nhttps://t.co/eHcgZPmQcz\",\"2020-01-23 18:00 +0000\",\"517.0\",\"5.0\",\"0.009671179883945842\",\"0.0\",\"0.0\",\"5.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1220326861772935170\",\"https://twitter.com/Lauren_Schaefer/status/1220326861772935170\",\"Craving some delicious #GirlScout cookies??? 🍪🍪🍪\n\nOrder from my friend who will use the proceeds so she can attend camp this summer.  Help her #LeadLikeAGirl\n\nAble to resist those super yummy cookies yourself? Order a box for the troops. :-)\n\nhttps://t.co/UXZ340uOcQ\",\"2020-01-23 12:46 +0000\",\"502.0\",\"6.0\",\"0.01195219123505976\",\"0.0\",\"0.0\",\"2.0\",\"0.0\",\"2.0\",\"0.0\",\"2.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1219318848572350464\",\"https://twitter.com/Lauren_Schaefer/status/1219318848572350464\",\"The epistemology of software quality https://t.co/k8xTO2QK9P\n\nSleep matters. 😴  Stress matters. 😫  Perhaps your programming language doesn't matter...\",\"2020-01-20 18:00 +0000\",\"491.0\",\"4.0\",\"0.008146639511201629\",\"0.0\",\"0.0\",\"3.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1218147364361441280\",\"https://twitter.com/Lauren_Schaefer/status/1218147364361441280\",\"Hey...I know that guy!  Congrats, @kenwalger! 🥳\n\nhttps://t.co/o17zCbwLKb\",\"2020-01-17 12:25 +0000\",\"655.0\",\"52.0\",\"0.07938931297709924\",\"0.0\",\"0.0\",\"8.0\",\"2.0\",\"31.0\",\"0.0\",\"11.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1217869301488803840\",\"https://twitter.com/Lauren_Schaefer/status/1217869301488803840\",\"23 lesser known #VSCode Shortcuts as GIF - DEV Community 👩‍💻👨‍💻 \n\nAlt + Z = Toggle World Wrap 😳\n\nhttps://t.co/RqglHtinbv https://t.co/eXGaWgW75k\",\"2020-01-16 18:00 +0000\",\"607.0\",\"12.0\",\"0.019769357495881382\",\"0.0\",\"0.0\",\"3.0\",\"2.0\",\"2.0\",\"0.0\",\"3.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"58\",\"2\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1217787856976056321\",\"https://twitter.com/Lauren_Schaefer/status/1217787856976056321\",\"@enterjsconf Thank you for the info!\",\"2020-01-16 12:37 +0000\",\"48.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1217457679205126146\",\"https://twitter.com/Lauren_Schaefer/status/1217457679205126146\",\"@enterjsconf How many attendees are you expecting this year?\",\"2020-01-15 14:45 +0000\",\"58.0\",\"4.0\",\"0.06896551724137931\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"3.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\r\n-----------------------------8165087126414182542096170685--\r\n`
            }
        },
        headers: {
            Host: "webhooks.mongodb-stitch.com",
            "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:73.0) Gecko/20100101 Firefox/73.0",
            Accept: "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
            "Accept-Language": "en-US,en;q=0.5",
            "Accept-Encoding": "gzip, deflate, br",
            "Content-Type": "multipart/form-data; boundary=---------------------------8165087126414182542096170685\]",
            "Content-Length": "12661",
            Connection: "keep-alive",
            "Upgrade-Insecure-Requests": 1,
            Pragma: "no-cache",
            "Cache-Control": "no-cache",
            TE: "Trailers",
        }
    })).toStrictEqual(mockTweetResults);

    expect(context.functions.execute).toHaveBeenCalledWith("storeCsvInDb", `\"Tweet id\",\"Tweet permalink\",\"Tweet text\",\"time\",\"impressions\",\"engagements\",\"engagement rate\",\"retweets\",\"replies\",\"likes\",\"user profile clicks\",\"url clicks\",\"hashtag clicks\",\"detail expands\",\"permalink clicks\",\"app opens\",\"app installs\",\"follows\",\"email tweet\",\"dial phone\",\"media views\",\"media engagements\",\"promoted impressions\",\"promoted engagements\",\"promoted engagement rate\",\"promoted retweets\",\"promoted replies\",\"promoted likes\",\"promoted user profile clicks\",\"promoted url clicks\",\"promoted hashtag clicks\",\"promoted detail expands\",\"promoted permalink clicks\",\"promoted app opens\",\"promoted app installs\",\"promoted follows\",\"promoted email tweet\",\"promoted dial phone\",\"promoted media views\",\"promoted media engagements\"\n\"1226928883355791360\",\"https://twitter.com/Lauren_Schaefer/status/1226928883355791360\",\"“Whether your company is based in a lower-paying area, or your employee is based in a lower-paying area does not matter...if you want to attract and retain above-average developers... #RemoteWork is a big bonus attraction to half of the tech workforce.”\n\nhttps://t.co/wso3RTFd1u\",\"2020-02-10 18:00 +0000\",\"1203.0\",\"39.0\",\"ssss\",\"4.0\",\"0.0\",\"7.0\",\"2.0\",\"22.0\",\"0.0\",\"4.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1226846945181917184\",\"https://twitter.com/Lauren_Schaefer/status/1226846945181917184\",\"@h_ingo Yes! It's so helpful. I'm working on using it more and more.\",\"2020-02-10 12:34 +0000\",\"32.0\",\"1.0\",\"0.03125\",\"0.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1226846634702757889\",\"https://twitter.com/Lauren_Schaefer/status/1226846634702757889\",\"@h_ingo https://t.co/n2tX8TNJFL\",\"2020-02-10 12:33 +0000\",\"35.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1226846610593845250\",\"https://twitter.com/Lauren_Schaefer/status/1226846610593845250\",\"@h_ingo Definitely. On a related node - I read an article that suggested remote teams focus more on results than other factors like politics or likability, which can reduce unconscious bias. This is a win for everyone--especially those from traditionally underrepresented groups.\",\"2020-02-10 12:33 +0000\",\"134.0\",\"2.0\",\"0.014925373134328358\",\"0.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225790691214811136\",\"https://twitter.com/Lauren_Schaefer/status/1225790691214811136\",\"@itsaydrian Perhaps.  Although, I find it's true in larger groups as well.\",\"2020-02-07 14:37 +0000\",\"88.0\",\"6.0\",\"0.06818181818181818\",\"0.0\",\"1.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"4.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225785799146430465\",\"https://twitter.com/Lauren_Schaefer/status/1225785799146430465\",\"I've found that I notice less that I'm the only woman in the \"\"room\"\" when I work remotely vs working in the office. My minority status feels less isolating when I'm remote. \n\nI can't find any stats or articles to back this up. Anyone else feel the same?\n\n#RemoteWork #WorkFromHome\",\"2020-02-07 14:18 +0000\",\"836.0\",\"18.0\",\"0.0215311004784689\",\"1.0\",\"2.0\",\"6.0\",\"3.0\",\"0.0\",\"1.0\",\"5.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225479302868873216\",\"https://twitter.com/Lauren_Schaefer/status/1225479302868873216\",\"For the fellow #parents out there...\n\nTech conferences with childcare\n\nhttps://t.co/91SuX4nHIy\n\n#WomenInTech #WomenInSTEM #PeopleInTech\",\"2020-02-06 18:00 +0000\",\"308.0\",\"4.0\",\"0.012987012987012988\",\"1.0\",\"0.0\",\"3.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225103341283348481\",\"https://twitter.com/Lauren_Schaefer/status/1225103341283348481\",\"@itsaydrian @mlynn @MongoDB https://t.co/MjghgZfXaP\",\"2020-02-05 17:06 +0000\",\"75.0\",\"2.0\",\"0.02666666666666667\",\"0.0\",\"0.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"12\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1225099723335503875\",\"https://twitter.com/Lauren_Schaefer/status/1225099723335503875\",\"@mlynn @MongoDB https://t.co/cB2i0Ho4B5\",\"2020-02-05 16:51 +0000\",\"131.0\",\"4.0\",\"0.030534351145038167\",\"0.0\",\"1.0\",\"1.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"24\",\"1\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224720773413249025\",\"https://twitter.com/Lauren_Schaefer/status/1224720773413249025\",\"@TheLeadDev Thank you!\",\"2020-02-04 15:46 +0000\",\"39.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224713763821162497\",\"https://twitter.com/Lauren_Schaefer/status/1224713763821162497\",\"@TheLeadDev How many attendees are you anticipating?\",\"2020-02-04 15:18 +0000\",\"145.0\",\"3.0\",\"0.020689655172413793\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"2.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224671846056058884\",\"https://twitter.com/Lauren_Schaefer/status/1224671846056058884\",\"@jessicaewest @LaunchDarkly So happy for you Jess! https://t.co/gh7dsvdmNu\",\"2020-02-04 12:31 +0000\",\"78.0\",\"2.0\",\"0.02564102564102564\",\"0.0\",\"1.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"23\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224392302615048192\",\"https://twitter.com/Lauren_Schaefer/status/1224392302615048192\",\"What is #JavaScript made of by @dan_abramov? https://t.co/A69ugbmEdt\n\nA great reminder of the JavaScript basics\",\"2020-02-03 18:00 +0000\",\"216.0\",\"2.0\",\"0.009259259259259259\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1224126591917264899\",\"https://twitter.com/Lauren_Schaefer/status/1224126591917264899\",\"Is there enough space in space for women?\n\n#MakeSpaceForWomen https://t.co/uPGApiLveh\",\"2020-02-03 00:24 +0000\",\"339.0\",\"3.0\",\"0.008849557522123894\",\"0.0\",\"0.0\",\"1.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222942690037379072\",\"https://twitter.com/Lauren_Schaefer/status/1222942690037379072\",\"How to evaluate a remote job https://t.co/FngPIiHTx0\n\n#remotework #WorkFromHome\",\"2020-01-30 18:00 +0000\",\"289.0\",\"2.0\",\"0.006920415224913495\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222583861579780096\",\"https://twitter.com/Lauren_Schaefer/status/1222583861579780096\",\"@nraboy @kenwalger Good call. https://t.co/SLbbsthzmF\",\"2020-01-29 18:14 +0000\",\"75.0\",\"1.0\",\"0.013333333333333334\",\"0.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"10\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222583364055642114\",\"https://twitter.com/Lauren_Schaefer/status/1222583364055642114\",\"@nraboy @kenwalger Is that expensable?\",\"2020-01-29 18:12 +0000\",\"76.0\",\"3.0\",\"0.039473684210526314\",\"0.0\",\"1.0\",\"0.0\",\"2.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222581543702597634\",\"https://twitter.com/Lauren_Schaefer/status/1222581543702597634\",\"What does #RonSwanson have to do with #MongoDB?\n\nWatch the recording of the Back to Basics webinar that @kenwalger and I hosted to find out:  https://t.co/WOgtUAcKrW https://t.co/1oCJ4Pe9dd\",\"2020-01-29 18:05 +0000\",\"639.0\",\"18.0\",\"0.028169014084507043\",\"0.0\",\"1.0\",\"4.0\",\"3.0\",\"5.0\",\"0.0\",\"2.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"88\",\"3\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1222222732953341954\",\"https://twitter.com/Lauren_Schaefer/status/1222222732953341954\",\"@ChegeHarrison @kenwalger https://t.co/TyaripZjmV\",\"2020-01-28 18:19 +0000\",\"77.0\",\"2.0\",\"0.025974025974025976\",\"0.0\",\"0.0\",\"1.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"15\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1221855530232225794\",\"https://twitter.com/Lauren_Schaefer/status/1221855530232225794\",\"Fantastic 13 minute keynote from @kelseyhightower where he touches on #diversity, #inclusion, &amp; running the race together. https://t.co/03X29YQr4j\",\"2020-01-27 18:00 +0000\",\"26818.0\",\"230.0\",\"0.008576329331046312\",\"4.0\",\"1.0\",\"12.0\",\"91.0\",\"58.0\",\"4.0\",\"16.0\",\"0.0\",\"1\",\"0\",\"0\",\"0\",\"0\",\"43\",\"43\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1220747798100021248\",\"https://twitter.com/Lauren_Schaefer/status/1220747798100021248\",\".@kenwalger and I are hosting a #MongoDB Back to Basics webinar Tuesday, January 28 at noon eastern. Hope to see you there!\n\nSlides: https://t.co/4t7jYcjKk6\nRegister: https://t.co/D8zKU3BKDc\",\"2020-01-24 16:38 +0000\",\"805.0\",\"126.0\",\"0.1565217391304348\",\"1.0\",\"0.0\",\"6.0\",\"10.0\",\"107.0\",\"0.0\",\"2.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1220405881155866626\",\"https://twitter.com/Lauren_Schaefer/status/1220405881155866626\",\"I was asked to sum up my remote work experience in one word. I chose \"\"quiet.\"\" This could explain why. When I'm working, I have guilt-free time to sit and think uninterrupted. And I really enjoy that.\n\nhttps://t.co/eHcgZPmQcz\",\"2020-01-23 18:00 +0000\",\"517.0\",\"5.0\",\"0.009671179883945842\",\"0.0\",\"0.0\",\"5.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1220326861772935170\",\"https://twitter.com/Lauren_Schaefer/status/1220326861772935170\",\"Craving some delicious #GirlScout cookies??? 🍪🍪🍪\n\nOrder from my friend who will use the proceeds so she can attend camp this summer.  Help her #LeadLikeAGirl\n\nAble to resist those super yummy cookies yourself? Order a box for the troops. :-)\n\nhttps://t.co/UXZ340uOcQ\",\"2020-01-23 12:46 +0000\",\"502.0\",\"6.0\",\"0.01195219123505976\",\"0.0\",\"0.0\",\"2.0\",\"0.0\",\"2.0\",\"0.0\",\"2.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1219318848572350464\",\"https://twitter.com/Lauren_Schaefer/status/1219318848572350464\",\"The epistemology of software quality https://t.co/k8xTO2QK9P\n\nSleep matters. 😴  Stress matters. 😫  Perhaps your programming language doesn't matter...\",\"2020-01-20 18:00 +0000\",\"491.0\",\"4.0\",\"0.008146639511201629\",\"0.0\",\"0.0\",\"3.0\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1218147364361441280\",\"https://twitter.com/Lauren_Schaefer/status/1218147364361441280\",\"Hey...I know that guy!  Congrats, @kenwalger! 🥳\n\nhttps://t.co/o17zCbwLKb\",\"2020-01-17 12:25 +0000\",\"655.0\",\"52.0\",\"0.07938931297709924\",\"0.0\",\"0.0\",\"8.0\",\"2.0\",\"31.0\",\"0.0\",\"11.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1217869301488803840\",\"https://twitter.com/Lauren_Schaefer/status/1217869301488803840\",\"23 lesser known #VSCode Shortcuts as GIF - DEV Community 👩‍💻👨‍💻 \n\nAlt + Z = Toggle World Wrap 😳\n\nhttps://t.co/RqglHtinbv https://t.co/eXGaWgW75k\",\"2020-01-16 18:00 +0000\",\"607.0\",\"12.0\",\"0.019769357495881382\",\"0.0\",\"0.0\",\"3.0\",\"2.0\",\"2.0\",\"0.0\",\"3.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"58\",\"2\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1217787856976056321\",\"https://twitter.com/Lauren_Schaefer/status/1217787856976056321\",\"@enterjsconf Thank you for the info!\",\"2020-01-16 12:37 +0000\",\"48.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n\"1217457679205126146\",\"https://twitter.com/Lauren_Schaefer/status/1217457679205126146\",\"@enterjsconf How many attendees are you expecting this year?\",\"2020-01-15 14:45 +0000\",\"58.0\",\"4.0\",\"0.06896551724137931\",\"0.0\",\"1.0\",\"0.0\",\"0.0\",\"0.0\",\"0.0\",\"3.0\",\"0.0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"0\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\",\"-\"\n`
        .toString('utf-8'));
})

test('No file uploaded', () => {

    expect(uploadTweets({
        body: {
            text: () => {
                return `-----------------------------8165087126414182542096170685\r\nContent-Disposition: form-data; name=\"Tweetcsv\"; filename=\"\"\r\nContent-Type: text/csv\r\n\r\n\r\n----------------------------8165087126414182542096170685--\r\n`
            }
        },
        headers: {
            Host: "webhooks.mongodb-stitch.com",
            "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:73.0) Gecko/20100101 Firefox/73.0",
            Accept: "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
            "Accept-Language": "en-US,en;q=0.5",
            "Accept-Encoding": "gzip, deflate, br",
            "Content-Type": "multipart/form-data; boundary=---------------------------8165087126414182542096170685\]",
            "Content-Length": "12661",
            Connection: "keep-alive",
            "Upgrade-Insecure-Requests": 1,
            Pragma: "no-cache",
            "Cache-Control": "no-cache",
            TE: "Trailers",
        }
    })).toBe("No files were uploaded");

    expect(context.functions.execute).toHaveBeenCalledTimes(0);
})
