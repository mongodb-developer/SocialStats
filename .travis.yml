dist: trusty
language: node_js
node_js:
- '12'
addons:
  # Installing dpkg to fix Chrome install errors
  apt:
    packages:
      - dpkg
  chrome: stable
before_script:
- java -jar tests/ui/selenium-server-standalone-3.141.59.jar &
script:
- npm install
- CHROMEDRIVER_VERSION=LATEST npm install chromedriver
# Run tests
- if [ $TRAVIS_BRANCH == "master" ] ; then
    echo "Production build so only running unit tests, which don't hit the database";
    ./node_modules/.bin/jest --runInBand ./tests/unit/;
  else 
    echo "Non-production build so running all tests. The database will be cleared as part of these tests.";
    # NOTE DISABLING UI TESTS TEMPORARILY WHILE WORKING ON GIT MERGE
    #./node_modules/.bin/jest --runInBand;
    ./node_modules/.bin/jest --runInBand ./tests/unit/;
  fi
after_success:
# If the tests pass on Staging, push the commits to Production
- if [ $TRAVIS_BRANCH == "staging" ] ; then
    git remote -v
    git remote add SocialStats https://${GITHUB_TOKEN}@github.com/mongodb-developer/SocialStats.git;
    git remote -v
    git checkout SocialStats/master;
    git merge SocialStats/staging;
    git push SocialStats master;
  fi
